<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Sassenach Studies ‚Äî Magazine</title>
<meta name="description" content="The Sassenach Studies ‚Äî a parchment & ink magazine hub for podcasts, videos, and essays." />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600..800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* ================================
   Sassenach Studies ‚Äî Parchment Magazine
   ================================ */

/* Tokens (Season 1 parchment & ink + red thread) */
:root{
  --ink-900:#111417;
  --ink-700:#2a3035;
  --ink-500:#4d5660;
  --paper:#f5efde;           /* parchment base */
  --paper-2:#efe6cf;         /* parchment mid */
  --paper-3:#e7dcc1;         /* parchment light */
  --stone:#d8cdb3;           /* borders / hairlines */
  --highlight:#b3262e;       /* red thread */
  --accent:#335c67;          /* cool ink accent */
  --radius:16px;
  --shadow:0 10px 25px rgba(0,0,0,.08), 0 2px 6px rgba(0,0,0,.06);
}

/* Parchment background (texture-lite, no external images) */
html,body{height:100%}
*{box-sizing:border-box}
body{
  margin:0;
  font:16px/1.6 Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans;
  color:var(--ink-900);
  background:
    radial-gradient(1200px 600px at 10% 0%, rgba(255,255,255,.45) 0%, rgba(255,255,255,0) 60%),
    radial-gradient(1000px 500px at 90% 0%, rgba(255,255,255,.35) 0%, rgba(255,255,255,0) 60%),
    linear-gradient(180deg, var(--paper) 0%, var(--paper-2) 50%, var(--paper-3) 100%);
  background-attachment: fixed;
}

/* Layout shell */
.container{max-width:1200px;margin:0 auto;padding:24px}
.hr{height:1px;background:linear-gradient(90deg, transparent, var(--stone), transparent);margin:8px 0 24px}

/* Header / Nav */
.header{
  position:sticky; top:0; z-index:9;
  background:linear-gradient(180deg, rgba(245,239,222,.96), rgba(245,239,222,.90));
  backdrop-filter:saturate(1.2) blur(6px);
  border-bottom:1px solid var(--stone);
}
.nav{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:12px 24px}
.brand{
  font-family:"Playfair Display", Georgia, serif;
  font-weight:800; letter-spacing:.2px; font-size:20px;
  display:flex; align-items:center; gap:10px;
}
.brand::before{
  content:"";
  width:14px;height:14px;border-radius:99px;
  background: radial-gradient(circle at 30% 30%, #e86a73, var(--highlight));
  box-shadow: 0 0 0 2px #fff inset, 0 0 0 1px #00000012;
}
.menu{display:flex;gap:18px;flex-wrap:wrap}
.menu a{
  text-decoration:none;color:var(--ink-900);font-weight:600;
  padding:8px 10px;border-radius:10px;
}
.menu a:hover{background:rgba(179,38,46,.08);color:var(--highlight)}

/* Section headings */
.section-head{
  display:flex;align-items:baseline;justify-content:space-between;gap:12px;
  margin:28px 0 12px;
}
.section-head h2{
  margin:0;font-size:26px;letter-spacing:.2px;
  font-family:"Playfair Display", Georgia, serif;
}
.section-head small{color:var(--ink-500)}
.see-all{
  font-weight:600;color:var(--accent);text-decoration:none;border-bottom:1px dashed var(--accent)
}
.see-all:hover{color:var(--highlight);border-bottom-color:var(--highlight)}

/* Grids */
.grid{
  display:grid; gap:18px;
}
.grid.cols-3{grid-template-columns:repeat(3, minmax(0,1fr))}
.grid.cols-4{grid-template-columns:repeat(4, minmax(0,1fr))}
@media (max-width:1000px){
  .grid.cols-4{grid-template-columns:repeat(3, minmax(0,1fr))}
}
@media (max-width:800px){
  .grid.cols-3,.grid.cols-4{grid-template-columns:repeat(2, minmax(0,1fr))}
}
@media (max-width:520px){
  .grid.cols-3,.grid.cols-4{grid-template-columns:1fr}
}

/* Card */
.card{
  background:linear-gradient(180deg,#fff, #fff7);
  border:1px solid var(--stone);
  border-radius:var(--radius);
  overflow:hidden; box-shadow:var(--shadow);
  display:flex;flex-direction:column;min-height:100%;
}
.media{
  aspect-ratio:16/9;background:#ddd;
  background-size:cover;background-position:center;
  border-bottom:1px solid var(--stone)
}
.badge{
  position:absolute;margin:10px;padding:6px 10px;border-radius:999px;
  font-size:12px;font-weight:700;letter-spacing:.3px;
  color:#fff;background:linear-gradient(180deg, #bf3a42, var(--highlight));
  box-shadow:0 6px 14px rgba(179,38,46,.35)
}
.meta{padding:14px 14px 8px}
.kicker{font-size:12px;letter-spacing:.3px;color:var(--ink-500);text-transform:uppercase}
.title{
  margin:6px 0 4px;font-size:18px;line-height:1.35;font-weight:800;
  font-family:"Playfair Display", Georgia, serif;
}
.desc{color:var(--ink-700);font-size:14px}
.actions{margin-top:auto;padding:12px 14px;display:flex;gap:8px;flex-wrap:wrap}
.button{
  text-decoration:none;font-weight:700;font-size:14px;
  padding:8px 12px;border-radius:10px;border:1px solid var(--stone);
  color:var(--ink-900); background:linear-gradient(180deg,#fff,#fff0)
}
.button[href*="listed.to"], .button.more{border-style:dashed}
.button:hover{border-color:var(--highlight);color:var(--highlight)}

/* Timeline (seasons) */
.timeline{
  background:linear-gradient(180deg, #fff8, #fff2);
  border:1px solid var(--stone); border-radius:var(--radius); padding:12px;
  display:flex;flex-wrap:wrap; gap:8px; align-items:center
}
.timeline .label{font-weight:700;margin-right:8px}
.tab{
  padding:8px 12px;border-radius:999px;border:1px solid var(--stone);
  background:#fff;font-weight:700; cursor:pointer
}
.tab.active{border-color:var(--highlight);color:#fff;background:linear-gradient(180deg,#c54b51,var(--highlight))}

/* Collage rows */
.collage{
  display:grid; gap:18px; grid-template-columns:2fr 1fr 1fr;
}
@media (max-width:900px){ .collage{grid-template-columns:1fr} }
.collage .card .media{aspect-ratio:21/9}

/* Footer */
.footer{
  margin-top:40px;padding:28px 0;border-top:1px solid var(--stone);
  color:var(--ink-500);font-size:14px;text-align:center
}
</style>
</head>
<body>

<header class="header">
  <nav class="nav">
    <div class="brand">The Sassenach Studies</div>
    <div class="menu" role="navigation" aria-label="Primary">
      <a href="#about">About</a>
      <a href="https://listed.to/@sassenachstudies" target="_blank" rel="noopener">Listed</a>
      <a href="#contact">Contact Us</a>
    </div>
  </nav>
</header>

<main class="container">

<!-- New Releases (Trending-style) -->
<aside class="trends">
  <div class="trends-head"><span>NEW RELEASES</span></div>
  <ol id="trends-list" class="trends-list" aria-live="polite"></ol>
</aside>


  <div class="hr"></div>

  <!-- Timeline / Season selector -->
  <div class="section-head">
    <h2>Timeline</h2>
    <small>Latest trio from the latest episode in each season</small>
  </div>
  <div id="timeline" class="timeline" role="tablist" aria-label="Seasons"></div>

  <div style="height:12px"></div>
  <div id="episode-trio" class="grid cols-3"></div>

  <div class="hr"></div>

  <!-- By format ‚Äî collage stacks -->
  <div class="section-head">
    <h2>Podcasts</h2>
    <a class="see-all" href="https://listed.to/@sassenachstudies?tag=podcast" target="_blank" rel="noopener">More Podcasts</a>
  </div>
  <div id="collage-audio" class="collage"></div>

  <div class="section-head">
    <h2>Videos</h2>
    <a class="see-all" href="https://listed.to/@sassenachstudies?tag=video" target="_blank" rel="noopener">More Videos</a>
  </div>
  <div id="collage-video" class="collage"></div>

  <div class="section-head">
    <h2>Articles</h2>
    <a class="see-all" href="https://listed.to/@sassenachstudies?tag=article" target="_blank" rel="noopener">More Articles</a>
  </div>
  <div id="collage-article" class="collage"></div>

  <footer class="footer">
    <div>¬© <span id="year"></span> The Sassenach Studies ¬∑ Parchment & Ink, Red Thread & Spiral</div>
  </footer>
</main>
<script>
// ================== Multi-source loader ==================
let CONTENT = [];   // flattened audio/video/article items for episodes
let NEWS = [];      // site announcements or news items

const byDateDesc = (a,b) => new Date(b.date) - new Date(a.date);
const $ = s => document.querySelector(s);

// --- Normalizers ---
// Accepts either a flat array of items that already look like your old CONTENT,
// OR a grouped structure like [{season:"S01", episodes:[{code:"E06", items:[...]}]}]
function normalizeEpisodes(raw){
  if (!Array.isArray(raw)) return [];
  const looksFlat = raw.length && raw[0].type && raw[0].season && raw[0].episode;
  if (looksFlat) return raw;

  // assume grouped structure ‚Üí flatten
  const out = [];
  for (const seasonBlock of raw){
    const season = seasonBlock.season || seasonBlock.code || seasonBlock.id || 'S00';
    for (const ep of (seasonBlock.episodes || [])){
      const epCode = ep.episode || ep.code || 'E00';
      for (const item of (ep.items || [])){
        out.push({
          type:   item.type,                         // "audio" | "video" | "article"
          season: String(season).match(/^S\d{2}$/) ? season : `S${String(season).padStart(2,'0')}`,
          episode:String(epCode).match(/^E\d{2}$/) ? epCode : `E${String(epCode).padStart(2,'0')}`,
          date:   item.date || new Date().toISOString(),
          title:  item.title || 'Untitled',
          desc:   item.desc || '',
          href:   item.href || '#',
          cover:  item.cover || ''
        });
      }
    }
  }
  return out;
}

// NEWS can be any shape that yields title, href, date (and optional type/desc)
function normalizeNews(raw){
  if (!Array.isArray(raw)) return [];
  return raw.map(x => ({
    type:  (x.type || 'news').toLowerCase(), // displays as kicker
    season: x.season || '',                   // optional
    episode:x.episode || '',
    date:  x.date || new Date().toISOString(),
    title: x.title || 'Update',
    desc:  x.desc || '',
    href:  x.href || '#',
    cover: x.cover || ''
  }));
}

// ------------- New Releases (prefer NEWS, else fall back to episode items) -------------
function renderNewReleases(){
  const target = document.querySelector("#trends-list");
  const base = NEWS.length ? NEWS : CONTENT;          // prefer news.json
  const latest = [...base].sort(byDateDesc).slice(0,4);

  target.innerHTML = latest.map(item => {
    const kicker = (item.type || 'news').toUpperCase();
    const nice = new Date(item.date).toLocaleDateString(undefined,{month:'short', day:'numeric'});
    const se = item.season && item.episode ? `${item.season} ¬∑ ${item.episode}` : null;
    return `
      <li>
        <span class="trend-kicker">${kicker}</span>
        <a class="trend-link" href="${item.href}" target="_blank" rel="noopener">${item.title}</a>
        ${item.desc ? `<div class="trend-sub">${item.desc}</div>` : ""}
        <div class="trend-meta">
          ${se ? `<span>${se}</span><span class="trend-dot"></span>` : ``}
          <time datetime="${item.date}">${nice}</time>
        </div>
      </li>`;
  }).join("");
}

// ------------- Existing functions below this line stay the same -------------
// seasons(), latestEpisodeIn(), trioFor(), renderTimeline(), renderCollage(), card(), inferCover() etc.

// ------------- Load both files from /data -------------
async function load(){
  // IMPORTANT: paths are relative to index.html; adjust if your folder differs
  const [episodesRaw, newsRaw] = await Promise.all([
    fetch('data/episode.json', {cache:'no-store'}).then(r => r.ok ? r.json() : []).catch(()=>[]),
    fetch('data/news.json',    {cache:'no-store'}).then(r => r.ok ? r.json() : []).catch(()=>[])
  ]);

  CONTENT = normalizeEpisodes(episodesRaw);
  NEWS    = normalizeNews(newsRaw);

  // Render once we have data
  $("#year").textContent = new Date().getFullYear();
  renderNewReleases();
  renderTimeline();
  renderCollage("audio",  "#collage-audio");
  renderCollage("video",  "#collage-video");
  renderCollage("article","#collage-article");
}
load();
</script>

<script>
// Auto-pick a cover image when none is provided
function inferCover(item){
  if (item.cover) return item.cover;

  try {
    const u = new URL(item.href);

    // Archive.org -> use services/img/{identifier}
    if (u.hostname.endsWith('archive.org')) {
      const parts = u.pathname.split('/').filter(Boolean);
      const id =
        (parts[0]==='details'  && parts[1]) ? parts[1] :
        (parts[0]==='download' && parts[1]) ? parts[1] : '';
      if (id) return `https://archive.org/services/img/${id}`;
    }

    // YouTube -> default thumbnail
    if (u.hostname.includes('youtube.com') || u.hostname==='youtu.be') {
      let v = u.searchParams.get('v');
      if (!v && u.hostname==='youtu.be') v = u.pathname.slice(1);
      if (v) return `https://img.youtube.com/vi/${v}/hqdefault.jpg`;
    }
  } catch(e) {
    // ignore bad URLs
  }

  // No good guess
  return '';
}

// Override the existing card() to hide media when no cover
function card(item){
  const badge = item.type.toUpperCase();
  const icon  = item.type==="audio" ? "üîä" : item.type==="video" ? "üé¨" : "üìù";
  const cover = inferCover(item);

  const media = cover
    ? `<div class="media" style="background-image:url('${cover}')">
         <span class="badge" aria-label="${badge}">${icon} ${badge}</span>
       </div>`
    : ''; // no placeholder if no cover

  return `
    <article class="card">
      ${media}
      <div class="meta">
        <div class="kicker">${item.season} ¬∑ ${item.episode}</div>
        <div class="title">${item.title}</div>
        <div class="desc">${item.desc||""}</div>
      </div>
      <div class="actions">
        <a class="button" href="${item.href}" target="_blank" rel="noopener">Open</a>
      </div>
    </article>`;
}
</script>


</body>
</html>

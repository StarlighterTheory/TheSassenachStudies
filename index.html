<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="color-scheme" content="light">
<title>The Sassenach Studies — Media Library</title>
<meta name="description" content="Audio & video library for The Sassenach Studies — Bloodlines & Timelines (Season 1)." />
<link rel="preconnect" href="https://archive.org" />
<style>
  /* =============================
     Sassenach Studies — clean 3×6 grid
     ============================= */

  :root{
    --ink:#2a2a2a;
    --ink-2:#3a3a3a;
    --parchment:#f3ecd8;
    --parchment-2:#efe6cf;
    --stone:#6c7a86;
    --fern:#6c8a6b;
    --thread:#c64a3a;
    --sky:#4a6b8a;
    --accent:#274C56;
  }

  html,body{height:100%}
  body{
    margin:0;
    font:16px/1.5 "Georgia", ui-serif, Cambria, "Times New Roman", serif;
    color:var(--ink);
    background:
      radial-gradient(1200px 800px at 10% 0%, rgba(255,255,255,.8), rgba(255,255,255,0)),
      var(--parchment);
  }



  header{display:grid; grid-template-columns:1fr auto; gap:16px; align-items:center; margin-bottom:18px}
  .brand{display:flex; gap:14px; align-items:center}
  .logo{width:54px; height:54px; border-radius:12px;
        background: conic-gradient(from 0deg, var(--sky), var(--parchment) 35%, var(--thread) 36% 64%, var(--parchment) 65%, var(--sky));
        box-shadow:0 2px 0 rgba(0,0,0,.05) inset, 0 2px 6px rgba(0,0,0,.15)}
  h1{font-size: clamp(20px, 3vw, 30px); margin:0}
  h1 small{display:block; font-size:.6em; color:var(--stone); letter-spacing:.5px}
  .actions a{display:inline-block; padding:8px 12px; border:2px solid var(--ink); border-radius:10px; text-decoration:none; color:var(--ink); background:linear-gradient(var(--parchment-2), var(--parchment)); box-shadow:0 2px 0 rgba(0,0,0,.08)}
  .actions a:hover{transform:translateY(-1px)}

/* Hero poster */
.hero{
  position:relative;
  border-radius:18px;
  overflow:hidden;
  margin:10px 0 22px;          /* same side margins as the grid (inside .wrap) */
  border:2px solid rgba(0,0,0,.1);
  background:var(--parchment-2);
}
.hero img{display:block; width:100%; height:auto;}
.hero .ribbon{
  position:absolute; left:16px; bottom:16px;
  background:rgba(255,255,255,.85);
  border:2px solid rgba(0,0,0,.15);
  padding:10px 14px; border-radius:10px;
}

.hero .ribbon h2{margin:0; font-size:clamp(18px, 2.2vw, 26px)}
.hero .ribbon p{margin:4px 0 0; font-size:.95rem; color:var(--stone)}

/* optional tiny cameo corners */
.hero:before,.hero:after{
  content:""; position:absolute; width:60px; height:60px; top:14px; border-radius:50%; opacity:.07;
  background:
    radial-gradient(circle at 60% 40%, var(--ink) 0 35%, transparent 37%),
    conic-gradient(from 0deg, transparent 0 40%, var(--ink) 0 41%, transparent 43% 100%)
}
.hero:before{left:14px}
.hero:after{right:14px; transform:scaleX(-1)}


  
  /* replace your old .wrap line with this */
.wrap{
  --gutter: clamp(16px, 4vw, 56px);
  --content: 1080px;
  max-width: calc(var(--content) + var(--gutter) * 2);
  margin: 0 auto;
  padding: 28px var(--gutter) 72px;
}

/* align hero + grid inside those gutters */
.hero{ margin: 12px 0 24px; }
.ss-wrap{ margin: 12px 0 4px; }

/* make columns equal width (replace 1fr 1fr 1.15fr) */
.ss-table{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }

/* optional: single column on small screens */
@media (max-width: 640px){
  .ss-table{ grid-template-columns: 1fr; }
}

  @media (max-width:980px){
    .ss-table{ grid-template-columns: 1fr; } /* stack on narrow screens */
  }

  /* ===== Cards (image-first) ===== */
  .ss-cell{
    background:#fff;
    border:1px solid rgba(0,0,0,.14);
    border-radius:12px;
    overflow:hidden;
    display:flex; flex-direction:column;
  }

  /* Global image default to avoid weird scaling */
  img{ max-width:100%; height:auto; }

  /* Full, uncropped thumbs with a consistent max-height */
  .ss-thumb{
    display:block;
    width:100%;
    max-height:240px;    /* tweak 200–300 if you want */
    object-fit:contain;  /* show full image */
    background:var(--parchment);
    border:0;
    border-radius:12px 12px 0 0;
    margin:0;
  }

  .ss-inner{ padding:.9rem .95rem; display:flex; flex-direction:column; min-height:160px; }
  .ss-top{ display:flex; align-items:center; gap:.55rem; margin:0 0 .55rem 0; }
  .ss-ep{ font:700 .75rem/1 system-ui; color:var(--fern); text-transform:uppercase; letter-spacing:.02em; }
  .ss-title{ font:700 1rem/1.15 ui-serif,Georgia,serif; margin:0; color:var(--ink); }
  .ss-log{ color:var(--ink-2); margin:.1rem 0 .5rem; }
  .ss-quote{ margin:.25rem 0 .5rem; padding-left:.7rem; border-left:3px solid rgba(0,0,0,.12); color:var(--stone); font-style:italic; }

  .ss-meta{ margin-top:auto; }
  .ss-links{ display:flex; gap:.6rem; flex-wrap:wrap; font-size:.92rem; color:var(--stone); }
  .ss-links a{ color:inherit; text-decoration:underline; text-underline-offset:2px; }
  .ss-links a:hover{ text-decoration:none; }

  .ss-btn{
    appearance:none; border:1px solid rgba(0,0,0,.2); background:#fff; color:var(--ink);
    font:700 .92rem/1 system-ui; padding:.55rem .75rem; border-radius:10px; cursor:pointer;
  }
  .ss-btn[aria-pressed="true"]{ background:var(--ink); color:#fff; }

  .ss-chip{
    display:inline-flex; align-items:center; gap:.45rem;
    border:1px solid rgba(0,0,0,.18); padding:.45rem .65rem; border-radius:10px; text-decoration:none; color:var(--ink);
  }
  .ss-chip .dot{ width:1.2rem; height:1.2rem; display:grid; place-items:center; border:1px solid rgba(0,0,0,.18); border-radius:50%; }

  /* Force parchment even if user prefers dark */
  :root{ color-scheme: only light; }
</style>
</head>
<body>
<header>
  <!-- logo + To blog button -->
</header>

<section class="hero" id="seasonHero" hidden>
  <img id="heroImg" alt="Season poster" />
  <div class="ribbon">
    <h2 id="heroTitle">Season 1 — Bloodlines &amp; Timelines</h2>
    <p id="heroBlurb">A six-part, Outlander-themed analytical series on spiral (connection) and red thread (commitment).</p>
  </div>
</section>

<section class="filters">…</section>

<div class="ss-wrap">
  <div class="ss-table" id="ss-table"></div>
</div>

  <section class="hero" id="seasonHero" hidden>
  <img id="heroImg" alt="Season poster" />
  <div class="ribbon">
    <h2 id="heroTitle">Season 1 — Bloodlines &amp; Timelines</h2>
    <p id="heroBlurb">A six-part, Outlander-themed analytical series on spiral (connection) and red thread (commitment).</p>
  </div>
</section>

<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <h1>The Sassenach Studies <small>Where fandoms meet footnotes</small></h1>
    </div>
    <div class="actions">
      <a href="https://listed.to/@SassenachStudies" target="_blank" rel="noopener">↗ To blog</a>
    </div>
  </header>

  <!-- 3×6 grid -->
  <div class="ss-wrap">
    <div class="ss-table" id="ss-table" role="table" aria-label="Episodes"></div>
  </div>

  <audio id="ss-audio" preload="none" aria-hidden="true"></audio>
</div>

<script>
(function(){
  // Adjust this path if your repo root differs:
  const HERO_SRC = '/TheSassenachStudies/season1_poster.jpg';

  const hero  = document.getElementById('seasonHero');
  const img   = document.getElementById('heroImg');

  if(hero && img){
    img.src = HERO_SRC;
    img.onload = ()=>{ hero.hidden = false; };
    img.onerror = ()=>{ hero.hidden = true; }; // stays hidden if missing
  }
})();
  
(async function(){
  // TODO: If your repo path differs, adjust these two lines:
  const CARDS_JSON_BASE = '/TheSassenachStudies/cards/';
  const THUMBS_BASE    = '/TheSassenachStudies/thumbs/';

  const CARDS_JSON = CARDS_JSON_BASE + 'cards.json';

  const table  = document.getElementById('ss-table');
  const player = document.getElementById('ss-audio');

  /* ---------- tiny audio button label helpers ---------- */
  const fmt=t=>{ if(!isFinite(t)||t<0) t=0; const m=Math.floor(t/60), s=Math.floor(t%60); return m+':'+String(s).padStart(2,'0'); };
  let currentBtn=null, rafId=null, lastSrc='';
  const setLabel=(btn,playing)=>{
    const cur = isFinite(player.currentTime) ? fmt(player.currentTime) : '0:00';
    const dur = (isFinite(player.duration)&&player.duration>0) ? fmt(player.duration) : '—:—';
    btn.textContent = playing ? `❚❚ Pause ${cur}/${dur}` : '▶ Play';
    btn.setAttribute('aria-pressed', playing ? 'true' : 'false');
  };
  const tick=()=>{ if(currentBtn && !player.paused) setLabel(currentBtn,true); rafId=requestAnimationFrame(tick); };
  const start=()=>{ cancelAnimationFrame(rafId); rafId=requestAnimationFrame(tick); };
  const stop =()=>{ cancelAnimationFrame(rafId); };

  document.addEventListener('click', async (e)=>{
    const btn = e.target.closest('.ss-btn');
    if(!btn) return;
    const src = btn.dataset.audio || '';
    if(!src) return;

    // same source: toggle pause/play
    const abs = new URL(src, location.href).href;
    if(lastSrc === abs){
      if(player.paused){ try{await player.play();}catch{} currentBtn=btn; setLabel(btn,true); start(); }
      else { player.pause(); setLabel(btn,false); stop(); }
      return;
    }
    // new source
    player.src = src; lastSrc = abs;
    try{ await player.play(); }catch{}
    if(currentBtn && currentBtn!==btn) setLabel(currentBtn,false);
    currentBtn = btn; setLabel(btn,true); start();
  });

  ['loadedmetadata','durationchange','timeupdate','play','pause','ended'].forEach(ev=>{
    player.addEventListener(ev, ()=>{
      if(!currentBtn) return;
      if(ev==='pause' || ev==='ended'){ setLabel(currentBtn,false); stop(); }
      else { setLabel(currentBtn,!player.paused); }
    });
  });

  /* ---------- load data safely ---------- */
  let data=[];
  try{
    const res = await fetch(CARDS_JSON, {cache:'no-store'});
    data = await res.json();
    if(!Array.isArray(data)) data = [];
  }catch(_){
    data = [];
  }
  data.sort((a,b)=>(a.ep||'').localeCompare(b.ep||''));

  // Always render 6 rows (pad if fewer)
  const rows = Array.from({length:6}, (_,i)=> data[i] || {ep:`S01E0${i+1}`});

  // Pick per-column thumb with fallbacks:
  // 1) thumb_audio / thumbAudio / thumb (generic)
  // 2) /thumbs/S01E01-audio.jpg
  // 3) /thumbs/S01E01.jpg
  const thumbPath = (ep, c, kind) => {
    const k1 = `thumb_${kind}`;
    const k2 = `thumb${kind[0].toUpperCase()+kind.slice(1)}`;
    return (
      (c[k1] && String(c[k1]).trim()) ||
      (c[k2] && String(c[k2]).trim()) ||
      (c.thumb && String(c.thumb).trim()) ||
      `${THUMBS_BASE}${ep}-${kind}.jpg`
    );
  };
  const fallbackThumb = (ep)=> `${THUMBS_BASE}${ep}.jpg`;

  const cell = (innerHtml, col) => `<div class="ss-cell" role="cell" data-col="${col}">${innerHtml}</div>`;

  table.insertAdjacentHTML('beforeend',
    rows.map(c=>{
      const ep      = (c.ep||'').trim();
      const title   = c.title || '';
      const log     = c.logline || '';
      const quote   = c.quote ? `\u201C${c.quote}\u201D` : '';
      const audio   = c.audio || '';
      const video   = c.video || '';
      const cardUrl = `${CARDS_JSON_BASE}${ep}.html`;

      const tAudio   = thumbPath(ep, c, 'audio');
      const tVideo   = thumbPath(ep, c, 'video');
      const tSummary = thumbPath(ep, c, 'summary');

      const imgTag = (src, fb)=>`
        <img class="ss-thumb"
             src="${src}"
             alt=""
             onerror="this.onerror=null; this.src='${fb}'">
      `;

      const links = [
        audio ? `<a class="ss-link" href="${audio}">Audio</a>` : '',
        c.transcript ? `<a class="ss-link" href="${c.transcript}">Post/Transcript</a>` : `<a class="ss-link" href="${cardUrl}">Card</a>`
      ].filter(Boolean).join('<span class="ss-dot">·</span>');

      const audioCell = `
        ${imgTag(tAudio, fallbackThumb(ep))}
        <div class="ss-inner">
          <div class="ss-top"><span class="ss-ep">${ep}</span><h3 class="ss-title">Audio</h3></div>
          ${audio ? `<button class="ss-btn" data-audio="${audio}" aria-pressed="false">▶ Play</button>` : `<div class="ss-log">—</div>`}
          <div class="ss-meta"><div class="ss-links">${links}</div></div>
        </div>
      `;

      const videoCell = `
        ${imgTag(tVideo, fallbackThumb(ep))}
        <div class="ss-inner">
          <div class="ss-top"><span class="ss-ep">${ep}</span><h3 class="ss-title">Video</h3></div>
          ${video ? `<a class="ss-chip" href="${video}"><span class="dot">▶</span><span>Open video</span></a>` : `<div class="ss-log">—</div>`}
          <div class="ss-meta"><div class="ss-links">
            ${video ? `<a href="${video}">Direct link</a><span class="ss-dot">·</span>` : ``}
            <a href="${cardUrl}">Card</a>
          </div></div>
        </div>
      `;

      const sumCell = `
        ${imgTag(tSummary, fallbackThumb(ep))}
        <div class="ss-inner">
          <div class="ss-top"><span class="ss-ep">${ep}</span><h3 class="ss-title">${title||'Summary'}</h3></div>
          ${log ? `<p class="ss-log">${log}</p>` : ``}
          ${quote ? `<blockquote class="ss-quote">${quote}</blockquote>` : ``}
          <div class="ss-meta"><div class="ss-links">
            ${c.transcript ? `<a href="${c.transcript}">Post/Transcript</a>` : `<a href="${cardUrl}">Card</a>`}
          </div></div>
        </div>
      `;

      return cell(audioCell,'Audio') + cell(videoCell,'Video') + cell(sumCell,'Summary');
    }).join('')
  );
})();
</script>
</body>
</html>
